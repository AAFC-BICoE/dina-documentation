<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>DINA Developer Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>DINA Developer Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_api_specifications">1. API Specifications</a></li>
<li><a href="#_high_level_architecture">2. High Level Architecture</a></li>
<li><a href="#_ide_setup">3. IDE Setup</a></li>
<li><a href="#_keycloak">4. Keycloak</a>
<ul class="sectlevel2">
<li><a href="#_groups">4.1. Groups</a></li>
<li><a href="#_roles_per_group">4.2. Roles per group</a></li>
<li><a href="#_user_attributes">4.3. User Attributes</a></li>
<li><a href="#_group_attributes">4.4. Group Attributes</a></li>
</ul>
</li>
<li><a href="#_dina_modules_api">5. DINA modules API</a>
<ul class="sectlevel2">
<li><a href="#_home_endpoint">5.1. Home endpoint</a></li>
<li><a href="#_meta_information">5.2. Meta information</a></li>
<li><a href="#_sparse_field_selection">5.3. Sparse field selection</a></li>
<li><a href="#_filtering">5.4. Filtering</a>
<ul class="sectlevel3">
<li><a href="#_simple_key_value_filter">5.4.1. Simple key-value filter</a></li>
<li><a href="#_rsql">5.4.2. RSQL</a></li>
</ul>
</li>
<li><a href="#_pagination">5.5. Pagination</a></li>
<li><a href="#_sorting">5.6. Sorting</a></li>
<li><a href="#_creating_a_resource">5.7. Creating a resource</a></li>
<li><a href="#_bulk_operations">5.8. Bulk operations</a></li>
</ul>
</li>
<li><a href="#_controlled_vocabulary">6. Controlled Vocabulary</a>
<ul class="sectlevel2">
<li><a href="#_vocabulary">6.1. Vocabulary</a></li>
<li><a href="#_managed_attribute">6.2. Managed Attribute</a></li>
<li><a href="#_field_extension">6.3. Field Extension</a></li>
</ul>
</li>
<li><a href="#_liquibase">7. Liquibase</a>
<ul class="sectlevel2">
<li><a href="#_liquibase_contexts">7.1. Liquibase Contexts</a></li>
<li><a href="#_liquibase_migration_file_convention">7.2. Liquibase migration file convention</a></li>
<li><a href="#_run_liquibase_from_maven">7.3. Run Liquibase from Maven</a></li>
</ul>
</li>
<li><a href="#_releasing_a_dina_module">8. Releasing a DINA module</a></li>
<li><a href="#_postgresql">9. PostgreSQL</a>
<ul class="sectlevel2">
<li><a href="#useful_queries">9.1. Useful Queries</a>
<ul class="sectlevel3">
<li><a href="#_rename_key_in_jsonb_array">9.1.1. Rename key in jsonb array</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_elasticsearch">10. Elasticsearch</a>
<ul class="sectlevel2">
<li><a href="#_update_mapping">10.1. Update Mapping</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide includes general developer documentation for DINA modules. Topics that are more related to the DINA system as a whole are covered in local-deployment <a href="https://aafc-bicoe.github.io/dina-local-deployment/">documentation</a>. Documentation about modules implementation is in <a href="https://aafc-bicoe.github.io/dina-base-api/">dina-base-api</a></p>
</div>
<div class="paragraph">
<p>UI development documentation (including the UI design guidelines) is covered in the dina-ui <a href="https://aafc-bicoe.github.io/dina-ui/">documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_specifications">1. API Specifications</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://dina-web.github.io/collection-specs/">collection-api</a></p>
</li>
<li>
<p><a href="https://dina-web.github.io/object-store-specs/">object-store-api</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/AAFC-BICoE/object-store-api/blob/master/docs/file_upload_download.adoc">File Upload</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://dina-web.github.io/agent-specs/">agent-api</a></p>
</li>
<li>
<p><a href="https://dina-web.github.io/sequence-specs/">sequence-api</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_high_level_architecture">2. High Level Architecture</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/DINA-AAFC_High_Level_Architecture.drawio.png" alt="DINA AAFC High Level Architecture.drawio">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ide_setup">3. IDE Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DINA Java-based projects are using <a href="https://projectlombok.org/">Lombok</a>, which may require additional setup in your IDE: <a href="https://projectlombok.org/setup/overview">IDE setup guides</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak">4. Keycloak</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_groups">4.1. Groups</h3>
<div class="paragraph">
<p>Groups are used to represent ownership access. A user can be in groups like <code>group-1</code>, <code>group-2</code>, etc, which would let them access certain collections and data sets but not others.
This could be done by checking the metadata of the particular item the user is trying to access against their group membership. New groups could be added without having to recompile or edit the configuration
of the deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you are planning to use the object-store, make sure the group names are following <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">s3 bucket naming rules</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_roles_per_group">4.2. Roles per group</h3>
<div class="paragraph">
<p>Roles per group are not directly supported by Keycloak. Groups are mostly used to assign a set of Roles to users inside a group. For example, a user with the role "Super User" could be in 2 groups <code>group-1</code> and <code>group-2</code>
but we would have no way to restrict to role to a certain group so the user would be a "Super User" in both groups. Creating very specific roles like “Group 1 Super User” is not really an option since it
would make the implementation quite complex in all the modules.</p>
</div>
<div class="paragraph">
<p>Since Keycloak supports subgroups, we can have subgroups like <code>/group-1/super-user</code> (subgroup of <code>group-1</code>) and use that to determine access in group-specific situations. It breaks away somewhat from the conceptual
separation of using roles for functional access and groups for ownership, but it still represents a functional solution that mixes both concepts.
Groups, including subgroups, can also have role mappings, which assign a specified role to all members of a group. As an example, a group-admin role which would be role-mapped to each of the &#8230;&#8203;/admins groups.
That would let us use the native role-based features of Spring Security as an initial check, then verify in code that the user belongs to the correct admin subgroup for whatever they&#8217;re trying to do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_attributes">4.3. User Attributes</h3>
<div class="paragraph">
<p>User attributes can be set using the Keycloak console. They will be returned in the Keycloak token so the services and user interface can use it.</p>
</div>
<div class="paragraph">
<p><code>agentId</code>: UUID of the person in the agent module to allow all the modules to be aware of the agent identifier that represents the authenticated users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_group_attributes">4.4. Group Attributes</h3>
<div class="paragraph">
<p>Group attributes can be set using the Keycloak console. They will be returned by the user module.</p>
</div>
<div class="paragraph">
<p><code>groupLabel-en</code>: label to display the group label by language (specified in the suffix with 2 letters ISO code)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dina_modules_api">5. DINA modules API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The modules provide a REST API that conforms to the <a href="https://jsonapi.org/">JSON:API</a> specification.</p>
</div>
<div class="sect2">
<h3 id="_home_endpoint">5.1. Home endpoint</h3>
<div class="paragraph">
<p>There is a "Home" endpoint at /api , which lists the available repositories.</p>
</div>
</div>
<div class="sect2">
<h3 id="_meta_information">5.2. Meta information</h3>
<div class="paragraph">
<p>You can access metadata about available repositories, resources, attributes, etc. at /api/meta/ .
This information is generated by <a href="https://www.crnk.io/releases/stable/documentation/#_meta_module">Crnk&#8217;s Meta Module</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sparse_field_selection">5.3. Sparse field selection</h3>
<div class="paragraph">
<p>You can limit which fields are included in a response using the fields.</p>
</div>
<div class="paragraph">
<p>Listing regions with "name" and "description" as the only included fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?fields[region]=name,description</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtering">5.4. Filtering</h3>
<div class="sect3">
<h4 id="_simple_key_value_filter">5.4.1. Simple key-value filter</h4>
<div class="listingblock">
<div class="content">
<pre>localhost:8080/api/region?filter[name]=ITS&amp;filter[description]=Internal%20Transcribed%20Spacer</pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "data": [
        {
            "id": "43",
            "type": "region",
            "attributes": {
                "symbol": "ITS",
                "name": "ITS",
                "description": "Internal Transcribed Spacer"
            }
        }
    ]
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rsql">5.4.2. RSQL</h4>
<div class="paragraph">
<p>seqdb-api supports <a href="https://github.com/jirutka/rsql-parser">RSQL (REST query language)</a> for more complex filter queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>localhost:8080/api/region?filter[rsql]=( name=='12S' or name=='142' )</pre>
</div>
</div>
<div class="paragraph">
<p>returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "data": [
        {
            "id": "142",
            "type": "region",
            "attributes": {
                "symbol": "142",
                "name": "142",
                "description": ""
            }
        },
        {
            "id": "284",
            "type": "region",
            "attributes": {
                "symbol": "12S",
                "name": "12S",
                "description": "mitochondrial"
            }
        },
        {
            "id": "366",
            "type": "region",
            "attributes": {
                "symbol": "12S",
                "name": "12S",
                "description": null
            }
        }
    ]
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pagination">5.5. Pagination</h3>
<div class="paragraph">
<p>You can paginate list data using "page[limit]" and "page[offset]" parameters.</p>
</div>
<div class="paragraph">
<p>The first page of regions with a page size of 100:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?page[limit]=100</pre>
</div>
</div>
<div class="paragraph">
<p>The second page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?page[limit]=100&amp;page[offset]=100</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sorting">5.6. Sorting</h3>
<div class="paragraph">
<p>You can sort listed data in ascending or descending order, and specify multiple sort fields.</p>
</div>
<div class="paragraph">
<p>Sorting regions by name (ascending):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?sort=name</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting regions by name (descending):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?sort=-name</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting regions by name (ascending) and description (descending when multiple regions have the same name):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/api/region?sort=name,-description</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_resource">5.7. Creating a resource</h3>
<div class="paragraph">
<p>Creating a new Region:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -XPOST -H "Content-Type: application/vnd.api+json" \
--data '{"data":{"type": "region", "attributes": {"name":"My Region", "description":"My Description", "symbol":"My Symbol"}}}' \
http://localhost:8080/api/region</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bulk_operations">5.8. Bulk operations</h3>
<div class="paragraph">
<p>Bulk operations are supported using the unofficial
<a href="https://github.com/json-api/json-api/blob/9c7a03dbc37f80f6ca81b16d444c960e96dd7a57/extensions/jsonpatch/index.md">jsonpatch</a>
extension to JSON:API implemented by the Crnk Operations Module.</p>
</div>
<div class="paragraph">
<p>Example request:</p>
</div>
<div class="paragraph">
<p>HTTP Method: PATCH</p>
</div>
<div class="paragraph">
<p>URL: (API path prefix)/operations</p>
</div>
<div class="paragraph">
<p>Headers:
  - Content-Type: application/json-patch+json
  - Accept: application/json-patch+json</p>
</div>
<div class="paragraph">
<p>Body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[{
	"op": "POST",
	"path": "region",
	"value": {
		"id": 1000,
		"type": "region",
		"attributes": {
			"name": "region-1",
			"description": "desc",
			"symbol": "symbol"
		}
	}
}, {
	"op": "POST",
	"path": "region",
	"value": {
		"id": 2000,
		"type": "region",
		"attributes": {
			"name": "region-2",
			"description": "desc",
			"symbol": "symbol"
		}
	}
}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reponse:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "data": {
            "id": "4",
            "type": "region",
            "attributes": {
                "symbol": "symbol",
                "name": "region-1",
                "description": "desc"
            }
        },
        "status": 201
    },
    {
        "data": {
            "id": "5",
            "type": "region",
            "attributes": {
                "symbol": "symbol",
                "name": "region-2",
                "description": "desc"
            }
        },
        "status": 201
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: The "id" field in a POST request to create a resource will not become the persisted
resource&#8217;s ID, but it is mandatory for the request. In the future this value could be used to
submit multiple resources linking to each other.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_controlled_vocabulary">6. Controlled Vocabulary</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_vocabulary">6.1. Vocabulary</h3>
<div class="paragraph">
<p>A Vocabulary represents a single thing/concept. An entry is composed of a <code>name</code>, a <code>term</code> and a <code>multilingualTitle</code> (<code>VocabularyElement</code> interface). They are platform defined and values are loaded from configuration files. They are usualy used to either suggest or restrict values for some fields defined in the DINA models.</p>
</div>
<div class="paragraph">
<p>Examples of vocabulary are : spatial reference system (SRS), type status, coordinate system &#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_managed_attribute">6.2. Managed Attribute</h3>
<div class="paragraph">
<p>A managed attribute also represents a single thing/concept. As opposed to vocabulary, they are user defined and values are loaded from the database.</p>
</div>
<div class="paragraph">
<p>Manage attribute extends vocabulary and adds the attributes <code>key</code>, <code>vocabularyElementType</code>, <code>acceptedValues</code>, and <code>multilingualDescription</code> through the <code>TypedVocabularyElement</code> interface.</p>
</div>
<div class="paragraph">
<p>They are used as semi-structured data where the <code>key</code> is stored with a value on the DINA models that support them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_field_extension">6.3. Field Extension</h3>
<div class="paragraph">
<p>Field extension represents a set a terms/concepts that are logicialy grouped. They usualy comes from a standard defined by an external body. The <code>fields</code> of a specific field extension are also implementing the <code>TypedVocabularyElement</code> interface. Field extensions are platform defined and loaded from configuration files.</p>
</div>
<div class="paragraph">
<p>They are used as semi-structured data where the extension, the version and the <code>key</code> are stored with a value on the DINA models that support them.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_liquibase">7. Liquibase</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.liquibase.org/index.html">Liquibase</a> is used to generate the database and migrate to new versions of the database schema. Changelogs are source xml files that describe schema changes to the database. Liquibase maintains a "DATABASECHANGELOG" table in the same database to keep track of which changelogs have been executed. When the application starts, any changelogs that have not been executed are executed.</p>
</div>
<div class="paragraph">
<p>Additional information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.liquibase.org/bestpractices.html">Liquibase Best Practices</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/changes/add_column.html">Change example: addColumn</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/generating_changelogs.html">Adding Liquibase support to an existing database</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_liquibase_contexts">7.1. Liquibase Contexts</h3>
<div class="paragraph">
<p>When developing for Dina modules certain data is needed for the application to run properly and to make testing easier. Which is why we separate our database migrations into categories known as contexts. The two main contexts are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>schema-change</p>
<div class="ulist">
<ul>
<li>
<p>Changes to the schema such as adding new columns, renaming tables, adding new tables.</p>
</li>
</ul>
</div>
</li>
<li>
<p>sample-data</p>
<div class="ulist">
<ul>
<li>
<p>sample data for developers, this should not be ran on PROD/UAT since it&#8217;s used for inserting sample data for developers and the data is already in PROD/UAT databases.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For PROD/UAT purposes, the context can be changed by editing the application.yml file which has all of the liquibase configurations. The contexts are a comma separated list of all of the contexts to be performed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_liquibase_migration_file_convention">7.2. Liquibase migration file convention</h3>
<div class="paragraph">
<p>The following convention should be followed by all Liquibase database migration files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration scripts live in <code>src/main/resources/db/changelog</code></p>
</li>
<li>
<p>Filename should follow the convention <code>&lt;UNIQUE_INCREMENTAL_ID&gt;-&lt;ISSUE_TITLE&gt;.xml</code> (e.g. <code>2-new_specimen_field_PHAC_containment_level.xml</code>)</p>
</li>
<li>
<p>A new migration file&#8217;s path should be added in an "include" tag of <code>src/main/resources/db/changelog/db.changelog-master.xml</code></p>
</li>
<li>
<p>The context of a <code>changeSet</code> in the migration xml file should always be set (e.g. <code>context="schema-change"</code>)</p>
</li>
<li>
<p>The <code>&lt;id&gt;</code> should use the filename convention without the file extension <code>&lt;UNIQUE_INCREMENTAL_ID&gt;-&lt;ISSUE_TITLE&gt;</code> if the file only includes 1 changeset, otherwise the following convention should be used: <code>&lt;UNIQUE_INCREMENTAL_ID&gt;-&lt;ISSUE_TITLE&gt;-&lt;WHAT_THE_CHANGESET_DOES&gt;</code> (ex: <code>id="11-Implement_new_workflow_entitie-Create_enum_types"</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When merging code to dev, we need to make sure the incremental number is always unique. If we have a duplicate, we should be reassigned a new identifier and update the <code>db.changelog-master.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_run_liquibase_from_maven">7.3. Run Liquibase from Maven</h3>
<div class="paragraph">
<p>It may be useful to run Liquibase without running the application. The Liquibase website has an <a href="https://docs.liquibase.com/tools-integrations/maven/workflows/creating-liquibase-projects-with-maven-postgresql.html">example</a> and <a href="https://github.com/AAFC-BICoE/seqdb-api">seqdb-api</a> contains the plugin defition and an example <code>liquibase.properties</code> file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_releasing_a_dina_module">8. Releasing a DINA module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process of releasing a dina module is the same for all modules. The CI will automatically build and release a new Docker image to Docker Hub when something is merged
in the master/main branch.</p>
</div>
<div class="paragraph">
<p>BICoE Docker Hub: <a href="https://hub.docker.com/u/aafcbicoe" class="bare">https://hub.docker.com/u/aafcbicoe</a></p>
</div>
<div class="paragraph">
<p>Java-based API:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From dev branch</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change the version by running <code>mvn versions:set -DnewVersion=X.X</code> from the root where <code>X.X</code> is the current version minus the <code>-SNAPSHOT</code></p>
</li>
<li>
<p>Add and Push to dev with message like "Prepare version x.x release"</p>
</li>
<li>
<p>Wait for CI to complete</p>
</li>
</ol>
</div>
</li>
<li>
<p>From master/main</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Merge dev into master (do NOT use Pull Request)</p>
</li>
<li>
<p>Push to master (it will trigger the deployment Docker Hub)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a new GitHub release</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The tag should be the version prefixed with v (e.g. v0.19)</p>
</li>
<li>
<p>The title should be the version (e.g. 0.19)</p>
</li>
<li>
<p>Add a Summary of the changes (looks at the previous versions for an example)</p>
</li>
<li>
<p>Publish the Release</p>
</li>
</ol>
</div>
</li>
<li>
<p>From dev branch</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change the version by running <code>mvn versions:set -DnewVersion=X.X-SNAPSHOT</code> from the root where X.X is the next increment in the version number</p>
</li>
<li>
<p>Add and Push to dev with message like "Prepare next development version"</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>DINA-UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From dev branch</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the the file <code>packages/dina-ui/package.json</code> and set the <code>version</code> value</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Same as the Java-based API except the second <code>From dev branch</code> can be skipped since the ui is not using development version.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_postgresql">9. PostgreSQL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="useful_queries">9.1. Useful Queries</h3>
<div class="sect3">
<h4 id="_rename_key_in_jsonb_array">9.1.1. Rename key in jsonb array</h4>
<div class="paragraph">
<p>The example is not aiming at perfomance.</p>
</div>
<div class="paragraph">
<p>Considering the following table :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE organism (id integer, determinations jsonb);</code></pre>
</div>
</div>
<div class="paragraph">
<p>With jsonb array in the <code>determinations</code> column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT INTO organism VALUES (1, '[
{
  "scientificNameSource": "GNA",
  "isPrimary": true,
  "isFileAs": true
},
{
  "scientificNameSource": "GNA",
  "isPrimary": false,
  "isFileAs": false
}
]');</code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to rename the key <code>isFileAs</code> to <code>isFiledAs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- unwrap the array and extract the value
WITH subquery AS (
  SELECT id, item, item -&gt; 'isFileAs' as att_value
  FROM organism, jsonb_array_elements(determinations) as item
),
-- remove the old attribute and create the new one with the value
-- reconstruct the array by grouping by id
subquery2 AS (
  select id, json_agg(jsonb_set(item-'isFileAs', '{isFiledAs}', att_value)) as updated_jsonb from subquery
  GROUP BY id
)

UPDATE organism
  SET determinations = updated_jsonb
  FROM subquery2
  WHERE organism.id = subquery2.id;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elasticsearch">10. Elasticsearch</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_update_mapping">10.1. Update Mapping</h3>
<div class="paragraph">
<p>When a new mapping or new mapping property must be added to a live index the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html">Update mapping API</a> can be used.</p>
</div>
<div class="paragraph">
<p>If the new mapping requires new Analyzer, an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html">update settings analysis</a> is required first.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Assuming <code>keyword_lowercase_analyzer</code> is already declared, add it to the multi-field <code>data.attributes.originalFilename</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X PUT "localhost:9200/dina_object_store_index/_mapping?pretty" -H 'Content-Type: application/json' -d'
{
  "properties": {
    "data.attributes.originalFilename": {
      "type": "text",
      "fields": {
        "prefix": {
          "type": "text",
          "analyzer": "keyword_lowercase_analyzer",
          "index_prefixes": {
            "min_chars" : 1,
            "max_chars" : 10
          }
        },
        "keyword": {
          "type": "keyword",
          "ignore_above": 256
        }
      }
    }
  }
}
'</pre>
</div>
</div>
<div class="paragraph">
<p>Refesh the index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST "localhost:9200/dina_object_store_index/_update_by_query?refresh"</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-05-29 15:29:01 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>
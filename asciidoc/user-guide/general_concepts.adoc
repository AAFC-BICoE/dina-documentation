[[general-concepts]]
= General Concepts

[[group]]
== Group

Groups are used to define set of users for administration purpose (mostly permissions). They usually align with collections.
A user can belong to more than 1 group.

Groups are also used to defined who owns an object. For example, an object in the object-store always belongs to a group.
Objects can only have 1 owner.

== Role

With the exception of Administrator, roles are always assigned per group.

.Roles:
Administrator::
    DINA Administrator
Super User::
    Group administrator
User::
    Regular user
Guest::
    Similar to a regular user but with less permissions on destructive operations
Read-Only::
    No data alteration possible

== Permissions

Permissions in DINA are strictly related to roles per the table below:

.Minimum role required for operation
[options="header"]
|=======================
|Resource              |Create      |Update      |Delete
|Material Sample       |Guest       |Guest       |User
|Controlled Vocabulary |Super User  |Super User  |Super User
|Form Template         |Object Owner|Object Owner|Object Owner
|Object Store objects  |Guest       |Guest       |Super User
|Agent (person)        |Guest       |Super User  |Super User
|=======================

Technicals: Permissions are mostly https://en.wikipedia.org/wiki/Role-based_access_control[Role-based access control] combined with https://en.wikipedia.org/wiki/Discretionary_access_control[Discretionary access control] with owner.


[[user]]
== User

Users (when explicitly allowed) can access the system. What a user can and cannot do is based on the group(s)/permission(s). When using an external Identity Provider (e.g. ESAS) the user account must be linked to the Identity Provider account. Once done, the user will be able to use a third-party authentication (e.g. ESAS) to access the system.

[[verbatim]]
== Verbatim

DINA has some fields that are prefixed with the word "verbatim". Verbatim is defined as "in exactly the same words as were used originally". These fields are used to capture the data as originally represented for example on a label or in in expedition notes.

[[identifiers]]
== DINA Identifiers

All object in DINA are identified with UUID (universally unique identifier). While this type of identifier is not considered human-readable (123e4567-e89b-12d3-a456-426614174000) it has the property to be virtually universally unique (chances of duplicates are close enough to zero to be considered negligible). Objects can be uniquely identifed even outside the DINA system.

[[primary_id]]
== Primary ID

Preferably unique identifier set by user. Non-unique identifiers are allowed and will require user to override duplication alert "Allowing Duplicate". This should *only* be done for historical bookkeeping purposes.

[[next_identifier]]
=== Next Available Identifier

Unique Primary ID creation by system for a material by concatenating the associated Collection string with the lowest unused integer. Ticking off the box will block manual <<primary_id>> entry.

[[barcode]]
== Barcode

Machine readable code output that would be obtained from a scanning gun. Can be used as another means of searching the database.

[[form_template]]
== Form Template

Form templates are used to customize the user interface by allowing you to choose field visibility and default values. The user can then use them for data entry on a single page or through a split operation.

=== Visibility
The owner (the user who created the template) can always see/use its templates. Optionally, the template can be made available to an entire <<group>> that the user has access to.

Allowing other users to see a group does not give them access to edit the form template, they are only able to use the form template.

=== Split Configuration

==== Core Concepts

Split Configurations enable you to define how material sample splits are automatically named and under what conditions they can be used.

Split Configurations are included with a form template, so you can have multiple split configurations depending on the type of material samples you're working with.

==== Defining a split configuration

You can add a split configuration to an existing form template, or you can create a new template for the split configuration.

When editing a form template, you can enable the split configuration in the Data Component sidebar by toggling the switch as shown in the following image:

image::form-template-split-configuration-toggle.png[]

After enabling it, you will see a Split Configuration section added at the top of the page, as shown in the following image:

image::form-template-split-configuration-overview.png[]

The split configuration contains the following parts:

1. The condition section
2. Condition Type
3. Material Sample Type
4. The Material Sample Name Generation section
5. Strategy
6. Generation Options

==== Condition Setup

The Condition section defines when a split configuration can be used. Currently, the only supported Condition Type is `Material Sample Type` condition.

A condition can be applied that this split configuration can only be used if the Material Sample being split from is a specific Material Sample Type.

The condition's primary purpose is to prevent split configurations from being used where they shouldn't be.

[source]
----
CNC-01 [Whole Organism]
  CNC-01-A [Culture Strain]
CNC-02 [Whole Organism]
----

If you have a condition where a split configuration can only be used if the material sample type is Whole Organism, then you will only be able to use that split configuration on `CNC-01` and `CNC-02`. You cannot use the `CNC-01-A` since it's not the correct type based on the condition.

Multiple Material Sample Types can be configured as the condition.

==== Material Sample Name Generation

The Material Sample Name Generation section defines how the name of the new material samples should be generated.

Currently, two `Strategies` are offered:

* Direct Parent
* Material Sample Type

==== Direct Parent Strategy

The `Direct Parent` strategy looks at all of the children of the parent being split off from and generates the new sequence based on that.

For example:
[source]
----
CNC-01 [Whole Organism]
  CNC-01-A [Culture Strain]
    CNC-01-A-a [Organism Part]
CNC-02 [Whole Organism]
----

If splitting from `CNC-01-A` using the Direct Parent strategy and generating 2 children, it will generate more children in sequence to `CNC-01-A-a`. The new material sample records will be:

[source]
----
CNC-01 [Whole Organism]
  CNC-01-A [Culture Strain]
    CNC-01-A-a [Organism Part]
    CNC-01-A-b [Organism Part] <-- Newly generated
    CNC-01-A-c [Organism Part] <-- Newly generated
CNC-02 [Whole Organism]
----

==== Material Sample Type Strategy

The `Material Sample Type` strategy is used to generate material sample names based on Material Sample Types that exist anywhere in the hierarchy tree, using a common top-level parent. For example, consider the following hierarchy:

For example:

[source]
----
CNC-01 [Whole Organism]
  CNC-01-A [Culture Strain]
    CNC-01-A-a [Organism Part]
      CNC-01-A-c [Organism Part]
    CNC-01-A-b [Organism Part]
  CNC-01-B [Culture Strain]

CNC-02 [Whole Organism]
  CNC-02-A [Culture Strain]
----

If we want to split off the `CNC-01-B` material sample using the Material Sample Type strategy with Organism Part as the selected type, it will generate the following material sample names:

[source]
----
CNC-01 [Whole Organism]
  CNC-01-A [Culture Strain]
    CNC-01-A-a [Organism Part]
      CNC-01-A-c [Organism Part]
    CNC-01-A-b [Organism Part]
  CNC-01-B [Culture Strain]
    CNC-01-B-d [Organism Part] <-- Newly generated

CNC-02 [Whole Organism]
  CNC-02-A [Culture Strain]
----

In this example, `CNC-01-B-d` was generated, and it continues the series from `CNC-01-A-c` because they share the same material sample type, even though they are not direct parent-child nodes. Note that this strategy is based on the highest level parent, so `CNC-02` is ignored since `CNC-01` would be the highest shared parent for splitting off `CNC-01-B`.

When using the Material Sample Type strategy, you need to specify the material sample type under Material Sample Info.

==== Generation Options

Once you have configured the `Strategy`, you can choose how the sequence should be generated. You can select one of the following options:

* a (Lowercase letters) - generates a sequence of lowercase letters: a, b, c, d, e, f, g, ..., z, aa, ab, ac, ...
* A (Uppercase letters) - generates a sequence of uppercase letters: A, B, C, D, E, F, G, ..., Z, AA, AB, AC, ...
* 1 (Numerical) - generates a sequence of numbers: 1, 2, 3, 4, 5, 6, 7, ...

==== Using Split Configurations

Now that your split configuration has been configured, it can now be used when you want to split a material sample to generate children material sample records.

The following settings will be used to demonstrate how to use a split configuration:

image::form-template-split-configuration-example.png[]

1. This split configuration can only be used when splitting from a material sample with `Whole Organism`.
2. The strategy to generate the name will use the Material Sample Type with capital letters.
3. Since the `Material Sample Type` strategy is used, the Material Sample Type in the `Material Sample Info` section must be provided and visible. The strategy will generate the sequence based on the `Culture Strain` material sample type.

This example form template will be called: "Culture Strain Split".


Next, on any Material Sample with a Material Sample Type of `Whole Organism`, the split configuration created can be used. On the Material Sample view page, there is a dropdown in the button bar to "Split":

image::form-template-split-configuration-select-split.png[]

If you do not see your split configuration appear, it means your condition configured is not allowing it to be used.

Click the "Split" button in the dropdown to continue the split.

The next screen will allow you to determine the number of Material Samples you wish to create and to see a preview of the generated names.

image::form-template-split-configuration-split-preview.png[]

1. This is the Material Sample name of the record you are splitting of from.
2. Configure the number of Material Samples you wish to generate.
3. A preview of the generated name based on the split configuration. Notice the capital letters at the end which was configured as the Generation option. This is also the first child with Culture Strain so it will start from "A".
4. This is the parent that these generated material samples will share. Same as 1.
5. The Material Sample Type of the generated records, this is configured in the form template.

Click the "Split" button to continue if the generated preview is correct.

You will now be brought to a bulk edit view where you can full edit all the records that will be generated. Notice how the Form Template is selected automatically.

Once you are finished editing the records, you can now click the "Save All" option which will actually create the records.

[[field_extensions]]
== Field extensions

Field extensions are fields with specific definitions that are defined by known standards. In order to add a specific field extension, a system administrator needs to provide a configuration file to the application.

[[managed_attributes]]
== Managed Attributes

Managed attributes are attributes that can be created and used by the users on-demand. They are usually used to track data that is not common enough to be captured in a regular field. A managed attribute can be of type `integer`, `string`, `date` or `boolean`.

[[material_sample_attachement]]
== Material Sample Attachements

Attachments refer to <<object-store-component>>.
